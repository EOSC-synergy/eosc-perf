config:
  node_agent: 'docker_compose'
  deploy_template: '.sqa-frontend/docker-compose.yml'
#  project_repos:
#    eosc-perf:
#      repo: 'https://github.com/EOSC-synergy/eosc-perf.git'
#      branch: 'frontend'

environment:
  JPL_DOCKERFORCEBUILD: 'true'
  LANG: C.UTF-8

sqa_criteria:
  qc_style:
    repos:
      eosc-perf-frontend:
        container: perf-frontend-testing
        commands: 
        - bash -c "cd /perf-testing/frontend-js && npm ci --audit=false && ./node_modules/.bin/eslint ./ -f checkstyle -o eslint-codestyle.xml"
        #- bash -c "cd /perf-frontend-testing && npm ci --audit=false && ./node_modules/.bin/eslint ./ -f stylish"
  qc_coverage:
    repos:
      eosc-perf-frontend:
        container: perf-frontend-testing
        commands:
        - bash -c "cd /perf-testing/frontend-js && npm test -- --verbose"
  qc_security:
    repos:
      eosc-perf-frontend:
        container: perf-frontend-testing
        commands:
          # Fail an audit if the results include a vulnerability with a level of high or higher:
          # parse the output for Warnings-NG plugin:
        - bash -c "cd /perf-testing/frontend-js && npm audit --audit-level=high --json | node ../.sqa-frontend/transform-audit.js > npm-audit.json"

timeout: 900

